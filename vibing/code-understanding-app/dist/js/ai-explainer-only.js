class AIValidatorOnly{constructor(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.initializeElements()):this.initializeElements()}initializeElements(){this.codeEditor=document.getElementById("codeEditor"),this.validateButton=document.getElementById("validateButton"),this.validationResults=document.getElementById("validationResults"),this.examplesContent=document.getElementById("examplesContent"),this.languageTabs=document.querySelectorAll(".language-tab"),this.currentLanguage="html",this.codeEditor&&this.validateButton&&this.validationResults&&this.examplesContent&&("undefined"!=typeof SyntaxChecker&&SyntaxChecker?this.syntaxChecker=new SyntaxChecker:(this.syntaxChecker=null,this.loadSyntaxChecker().catch(()=>{})),this.init())}init(){this.validateButton&&(this.setupEventListeners(),this.loadExamples())}setupEventListeners(){this.validateButton&&(this.validateButton.addEventListener("click",()=>this.explainCode()),this.languageTabs.forEach(e=>{e.addEventListener("click",()=>this.switchLanguage(e.dataset.language))}))}async explainCode(){const e=this.codeEditor.value.trim();if(e){uiManager.setButtonLoading("validateButton",!0,"Analyzing...");try{const t=await this.explainWithAI(e,this.currentLanguage);t?this.displayAIExplanation(t):this.showExplanationResult("Unable to generate explanation. Please try again.","error"),window.progressTracker&&window.progressTracker.incrementValidations()}catch(e){uiManager.showError("Code explanation failed. Please try again.",()=>this.explainCode()),this.showExplanationResult("Unable to explain code. Please check your connection and try again.","error")}finally{uiManager.setButtonLoading("validateButton",!1)}}else this.showExplanationResult("Please enter some code to explain.","info")}async explainWithAI(e,t){try{if(this.showExplanationResult("Analyzing your code...","loading"),!e||!t)throw new Error("Code and language are required");let n,a=3;for(;a>0;)try{if(n=await apiService.post("/api/groq",{code:e,language:t.toLowerCase(),task:"code-explanation",responseStyle:"normal"}),n&&(n.response||n.explanation))break;throw new Error("Invalid response format")}catch(e){if(a--,0===a)throw e;await new Promise(e=>setTimeout(e,1e3))}if(!n||!n.response&&!n.explanation)throw new Error("Failed to get explanation");return n}catch(e){const t="Failed to fetch"===e.message?"Connection error. Please check your internet connection and try again.":"Unable to explain the code at the moment. Please try again in a few moments.";return this.showExplanationResult(t,"error"),null}}displayAIExplanation(e){let t=e.response||e.explanation||e;"string"!=typeof t&&(t=JSON.stringify(t));let n='<div class="ai-explanation-results">';n+=`\n      <div class="explanation-header">\n        <div class="explanation-title">\n          <i class="fas fa-code"></i>\n          <h3>Code Analysis</h3>\n        </div>\n        <div class="explanation-meta">\n          <span class="language-badge ${this.currentLanguage}">\n            ${this.currentLanguage.toUpperCase()}\n          </span>\n        </div>\n      </div>\n    `,n+='<div class="explanation-content">',n+=`<div class="explanation-text">${this.formatResponse(t)}</div>`,n+="</div>",n+='\n      <div class="explanation-footer">\n        <button class="btn btn-copy" onclick="navigator.clipboard.writeText(document.querySelector(\'.code-example\').textContent)">\n          <i class="fas fa-copy"></i> Copy Code Example\n        </button>\n      </div>\n    ',n+="</div>",this.validationResults.innerHTML=n,window.syntaxHighlighter&&this.validationResults.querySelectorAll("pre code").forEach(e=>{const t=e.className.replace("language-","")||this.currentLanguage;window.syntaxHighlighter.highlightElement(e,t)})}loadSyntaxChecker(){return new Promise((e,t)=>{if("undefined"!=typeof SyntaxChecker&&SyntaxChecker)return this.syntaxChecker=new SyntaxChecker,e(this.syntaxChecker);if(document.querySelector('script[data-syntax-checker="1"]')){const n=setInterval(()=>{"undefined"!=typeof SyntaxChecker&&SyntaxChecker&&(clearInterval(n),this.syntaxChecker=new SyntaxChecker,e(this.syntaxChecker))},50);return void setTimeout(()=>{if(clearInterval(n),this.syntaxChecker)return e(this.syntaxChecker);t(new Error("syntax-checker load timeout"))},5e3)}const n=document.createElement("script");n.src="js/syntax-checker.js",n.setAttribute("data-syntax-checker","1"),n.onload=()=>{"undefined"!=typeof SyntaxChecker&&SyntaxChecker?(this.syntaxChecker=new SyntaxChecker,e(this.syntaxChecker)):t(new Error("SyntaxChecker not available after load"))},n.onerror=e=>t(e||new Error("Failed to load syntax-checker.js")),document.head.appendChild(n)})}_runFallbackValidation(e){let t={errors:[],warnings:[]};switch(this.currentLanguage){case"html":t=this.syntaxChecker.checkHTML(e);break;case"css":t=this.syntaxChecker.checkCSS(e);break;case"javascript":t=this.syntaxChecker.checkJavaScript(e)}this.displayValidationResults(t)}fallbackValidation(e){this.syntaxChecker?this._runFallbackValidation(e):this.loadSyntaxChecker().then(()=>{this.syntaxChecker?this._runFallbackValidation(e):this.showExplanationResult("Validation engine unavailable.","error")}).catch(e=>{this.showExplanationResult("Validation unavailable. Please open the Code Explainer page to enable validation.","error")})}displayValidationResults(e){let t="";e.errors.length>0&&(t+='<div class="validation-errors">',t+="<h4>❌ Errors Found:</h4>",e.errors.forEach(e=>{t+=`<div class="validation-item error">\n          <strong>Line ${e.line}:</strong> ${e.message}\n          ${e.suggestion?`<br><em>Suggestion: ${e.suggestion}</em>`:""}\n        </div>`}),t+="</div>"),e.warnings.length>0&&(t+='<div class="validation-warnings">',t+="<h4>⚠️ Warnings:</h4>",e.warnings.forEach(e=>{t+=`<div class="validation-item warning">\n          <strong>Line ${e.line}:</strong> ${e.message}\n          ${e.suggestion?`<br><em>Suggestion: ${e.suggestion}</em>`:""}\n        </div>`}),t+="</div>"),0===e.errors.length&&0===e.warnings.length&&(t='<div class="validation-success">✅ Your code looks good! No errors or warnings found.</div>'),this.validationResults.innerHTML=t}showExplanationResult(e,t="info"){let n=`\n      <div class="explanation-${t}">\n        <div class="message-content">\n          ${{info:'<i class="fas fa-info-circle"></i>',error:'<i class="fas fa-exclamation-circle"></i>',loading:'<i class="fas fa-spinner fa-spin"></i>',success:'<i class="fas fa-check-circle"></i>'}[t]}\n          <span>${e}</span>\n        </div>\n        ${"error"===t?'\n          <div class="error-actions">\n            <button class="btn btn-retry" onclick="aiValidator.explainCode()">\n              <i class="fas fa-redo"></i> Try Again\n            </button>\n          </div>\n        ':""}\n      </div>\n    `;this.validationResults.innerHTML=n,"info"===t&&setTimeout(()=>{this.validationResults.querySelector(".explanation-info")&&(this.validationResults.innerHTML="")},5e3)}formatResponse(e){return(e=(e=e.replace(/```(\w+)?\n([\s\S]*?)```/g,(e,t,n)=>`<pre><code class="language-${t||"text"}">${this.escapeHtml(n.trim())}</code></pre>`)).replace(/`([^`]+)`/g,"<code>$1</code>")).replace(/\n/g,"<br>")}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}switchLanguage(e){this.currentLanguage=e,this.languageTabs.forEach(t=>{t.classList.toggle("active",t.dataset.language===e)}),window.syntaxHighlighter&&window.syntaxHighlighter.removeHighlighting(this.codeEditor),this.codeEditor.placeholder={html:"Enter your HTML code here...\n\nExample:\n<h1>Hello World</h1>\n<p>This is a paragraph.</p>",css:"Enter your CSS code here...\n\nExample:\nbody {\n  font-family: Arial, sans-serif;\n  color: #333;\n}",javascript:'Enter your JavaScript code here...\n\nExample:\nfunction greet(name) {\n  return "Hello, " + name + "!";\n}\n\nconsole.log(greet("World"));'}[e],this.codeEditor.value="",window.syntaxHighlighter&&setTimeout(()=>{window.syntaxHighlighter.applyHighlighting(this.codeEditor,e)},100),this.validationResults.innerHTML=""}loadExamples(){fetch("data/ai-knowledge.json").then(e=>e.json()).then(e=>{e.code_examples&&this.renderExamples(e.code_examples)}).catch(e=>{})}renderExamples(e){let t="";Object.keys(e).forEach(n=>{e[n].forEach(e=>{t+=`\n          <div class="example-item" onclick="aiValidator.loadExample('${n}', '${e.title.replace(/'/g,"\\'")}')">\n            <h4>${e.title}</h4>\n            <p>${e.description}</p>\n            <span class="example-language">${n.toUpperCase()}</span>\n          </div>\n        `})}),this.examplesContent.innerHTML=t}loadExample(e,t){fetch("data/ai-knowledge.json").then(e=>e.json()).then(n=>{const a=n.code_examples[e].find(e=>e.title===t);a&&(this.switchLanguage(e),this.codeEditor.value=a.code,window.syntaxHighlighter&&setTimeout(()=>{window.syntaxHighlighter.applyHighlighting(this.codeEditor,e)},100))}).catch(e=>{})}}let aiValidator;aiValidator=new AIValidatorOnly;