document.addEventListener("DOMContentLoaded",function(){window.CONFIG||(window.CONFIG=window.CONFIG||{});var e=!!window.uiManager,n=!!window.apiService,t=document.getElementById("code"),o=document.getElementById("output");if("localhost"===window.location.hostname||window.location.hostname,t&&o){var a=!1,i=!1,r=null,c=0,l='<!DOCTYPE html>\n    <html>\n    <head>\n        <title>My Web Page</title>\n        <style>\n            body {\n                font-family: Arial, sans-serif;\n                margin: 20px;\n                line-height: 1.6;\n            }\n            .container {\n                max-width: 800px;\n                margin: 0 auto;\n            }\n            h1 {\n                color: #2c3e50;\n            }\n        </style>\n    </head>\n    <body>\n        <div class="container">\n            <h1>Welcome to the Code Editor</h1>\n            <p>Start coding here!</p>\n        </div>\n    </body>\n    </html>',s=document.getElementById("run"),d=document.getElementById("clear"),u=document.getElementById("save"),m=document.getElementById("autoRunToggle");s&&s.addEventListener("click",f),d&&d.addEventListener("click",function(){t.value="",o.srcdoc=""}),u&&u.addEventListener("click",function(){var e=t.value,n=new Blob([e],{type:"text/html"}),o=URL.createObjectURL(n),a=document.createElement("a");a.href=o,a.download="code.html",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}),m&&m.addEventListener("click",function(){i=!i;var e=document.getElementById("autoRunToggle");if(e){i=!i,e.classList.toggle("active",i);var n=e.querySelector("i"),t=Array.from(e.childNodes).find(function(e){return e.nodeType===Node.TEXT_NODE&&""!==e.textContent.trim()});if(t)t.textContent=i?" Auto Run: ON":" Auto Run: OFF";else{var o=document.createElement("span");o.textContent=i?" Auto Run: ON":" Auto Run: OFF",e.appendChild(o)}n&&(i?(n.className="fas fa-sync-alt fa-spin",f()):(n.className="fas fa-sync-alt",r&&(clearTimeout(r),r=null)))}}),t&&t.addEventListener("input",function(){i&&r&&clearTimeout(r),i&&(r=setTimeout(function(){f()},1e3))});var p=new URLSearchParams(window.location.search).get("lesson")||localStorage.getItem("lesson");if(p){if(e)try{uiManager.showLoading("code","Loading lesson...")}catch(e){}if(n)apiService.get("/api/lessons/".concat(p)).then(function(n){if(e)try{uiManager.hideLoading("code")}catch(e){}if(t.value=n&&n.exercise&&n.exercise.starter?n.exercise.starter:l,"localhost"===window.location.hostname||window.location.hostname,e)try{uiManager.showSuccess("Lesson loaded successfully!")}catch(e){}}).catch(function(n){if(e)try{uiManager.hideLoading("code")}catch(e){}if(e&&CONFIG&&CONFIG.MESSAGES&&CONFIG.MESSAGES.LESSON_LOAD_ERROR)try{uiManager.showError(CONFIG.MESSAGES.LESSON_LOAD_ERROR)}catch(e){}t.value=l,"localhost"===window.location.hostname||window.location.hostname});else{if(e)try{uiManager.hideLoading("code")}catch(e){}t.value=l}}else t.value=l,"localhost"===window.location.hostname||window.location.hostname;i||setTimeout(f,100)}function f(){if(!a){var e=Date.now();if(!(e-c<500)){c=e,a=!0;try{o.classList.add("loading");var n=t.value;o.sandbox="allow-scripts allow-same-origin allow-forms allow-popups";var i=n.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"\x3c!-- Script removed for security --\x3e").replace(/javascript:/gi,"#").replace(/on\w+\s*=/gi,"data-disabled="),r="\n        <!DOCTYPE html>\n        <html>\n          <head>\n            ".concat("\n        <meta http-equiv=\"Content-Security-Policy\" \n              content=\"default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:;\n                      style-src 'self' 'unsafe-inline' https:;\n                      img-src 'self' data: https:;\n                      connect-src 'self' http: https:;\">","\n            <base target=\"_blank\">\n            <style>\n              /* Default styles for preview */\n              body {\n                margin: 0;\n                padding: 20px;\n                font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n                line-height: 1.6;\n              }\n              /* Error display styling */\n              .error-display {\n                background: #fee;\n                color: #e74c3c;\n                padding: 10px;\n                border-radius: 4px;\n                border-left: 4px solid #e74c3c;\n                margin: 10px 0;\n                font-family: monospace;\n                white-space: pre-wrap;\n              }\n            </style>\n          </head>\n          <body>\n            <script>\n              window.onerror = function(msg, url, line, col, error) {\n                const errorDiv = document.createElement('div');\n                errorDiv.className = 'error-display';\n                errorDiv.textContent = `Error: ${msg}\\nLine: ${line}\\nColumn: ${col}`;\n                document.body.insertBefore(errorDiv, document.body.firstChild);\n                return false;\n              };\n            <\/script>\n            ").concat(i,"\n          </body>\n        </html>\n      "),l=new Blob([r],{type:"text/html"}),s=URL.createObjectURL(l);o.src=s,o.onload=function(){URL.revokeObjectURL(s),o.classList.remove("loading"),a=!1,d&&clearTimeout(d)},o.onerror=function(e){o.classList.remove("loading"),o.srcdoc='\n          <html><body style="margin:0;padding:20px;font-family:sans-serif;">\n            <div style="background:#fee;color:#e74c3c;padding:15px;border-radius:4px;border-left:4px solid #e74c3c;">\n              <h3 style="margin:0 0 10px 0">Error loading preview</h3>\n              <p style="margin:0">Please check your code for errors.</p>\n              '.concat(e?'<pre style="margin:10px 0 0 0;font-size:14px">'.concat(e.toString(),"</pre>"):"","\n            </div>\n          </body></html>\n        "),a=!1};var d=setTimeout(function(){a&&(o.classList.remove("loading"),o.srcdoc='\n            <html><body style="margin:0;padding:20px;font-family:sans-serif;">\n              <div style="background:#fff3cd;color:#856404;padding:15px;border-radius:4px;border-left:4px solid #856404;">\n                <h3 style="margin:0 0 10px 0">Execution Timeout</h3>\n                <p style="margin:0">Your code took too long to execute. This might be due to an infinite loop or heavy computation.</p>\n              </div>\n            </body></html>\n          ',a=!1)},1e4)}catch(e){o.classList.remove("loading"),runTimeout&&clearTimeout(runTimeout),o.srcdoc='\n        <html><body style="margin:0;padding:20px;font-family:sans-serif;">\n          <div style="background:#fee;color:#e74c3c;padding:15px;border-radius:4px;border-left:4px solid #e74c3c;">\n            <h3 style="margin:0 0 10px 0">Error running code</h3>\n            <p style="margin:0 0 10px 0">There was a problem executing your code. Please check for syntax errors.</p>\n            <pre style="margin:0;font-size:14px">'.concat(e.toString(),"</pre>\n          </div>\n        </body></html>\n      "),a=!1}}}}});