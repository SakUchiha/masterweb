document.addEventListener("DOMContentLoaded",function(){let s=[],n=[];const e=document.querySelector(".lessons-grid"),t=document.querySelector(".progress-stats"),a=document.querySelectorAll(".filter-btn");async function i(){!function(){if(!e)return;e.innerHTML=`\n      <div class="loading-state">\n        <div class="spinner"></div>\n        <p>Loading lessons...</p>\n      </div>\n      ${Array(6).fill().map(()=>'\n        <div class="skeleton-card">\n          <div class="skeleton skeleton-title"></div>\n          <div class="skeleton skeleton-text"></div>\n          <div class="skeleton skeleton-text"></div>\n          <div class="skeleton skeleton-text"></div>\n        </div>\n      ').join("")}\n    `}(),await l(),a.forEach(e=>{e.addEventListener("click",()=>{a.forEach(s=>s.classList.remove("active")),e.classList.add("active");const t=e.dataset.category;n="all"===t?[...s]:s.filter(s=>s.category===t),o(n)})}),document.addEventListener("click",s=>{const n=s.target.closest(".start-lesson");if(n){const s=n.dataset.lessonId;s&&(localStorage.setItem("currentLesson",s),window.location.href=`lesson-viewer.html?id=${s}`)}})}async function l(){try{const e=await fetch(`${CONFIG.API_BASE_URL}/api/lessons`);if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const a=await e.json();s=a.map(s=>({...s,progress:s.progress||0,level:s.difficulty,icon:"HTML"===s.category?"fab fa-html5":"CSS"===s.category?"fab fa-css3-alt":"fab fa-js"})),n=[...s],o(n),function(){if(!t)return;const n=s.length,e=s.filter(s=>100===s.progress).length,a=n>0?Math.round(e/n*100):0;t.innerHTML=`\n      <div class="stat-item">\n        <span class="stat-value">${n}</span>\n        <span class="stat-label">Total Lessons</span>\n      </div>\n      <div class="stat-item">\n        <span class="stat-value">${e}</span>\n        <span class="stat-label">Completed</span>\n      </div>\n      <div class="stat-item">\n        <span class="stat-value">${a}%</span>\n        <span class="stat-label">Overall Progress</span>\n      </div>\n    `}()}catch(s){!function(s){if(!e)return;e.innerHTML=`\n      <div class="error-state">\n        <i class="fas fa-exclamation-circle"></i>\n        <p>${s}</p>\n        <button class="btn btn-primary" onclick="location.reload()">\n          Try Again\n        </button>\n      </div>\n    `}(`Failed to load lessons: ${s.message}`)}}function o(s){e&&(e.innerHTML="",0!==s.length?s.forEach(s=>{const n=function(s){const n=document.createElement("div");return n.className="lesson-card",n.dataset.category=s.category,n.innerHTML=`\n      <div class="lesson-card-inner">\n        <div class="lesson-header">\n          <div class="lesson-category">\n            <i class="${s.icon}"></i>\n            <span>${s.category}</span>\n          </div>\n          <div class="lesson-meta">\n            <span class="duration"><i class="far fa-clock"></i> ${s.duration}</span>\n            <span class="difficulty ${s.difficulty.toLowerCase()}">${s.difficulty}</span>\n          </div>\n        </div>\n        <div class="lesson-content">\n          <h3>${s.title}</h3>\n          <p class="lesson-summary">${s.summary||""}</p>\n          <p class="lesson-description">${s.description||""}</p>\n          ${s.learningObjectives?`\n            <div class="learning-objectives">\n              <h4>Learning Objectives:</h4>\n              <ul>\n                ${s.learningObjectives.map(s=>`<li>${s}</li>`).join("")}\n              </ul>\n            </div>\n          `:""}\n          <div class="progress-container">\n            <div class="progress-bar">\n              <div style="width: ${s.progress}%"></div>\n            </div>\n            <span class="progress-text">${s.progress}% Complete</span>\n          </div>\n          <button class="btn btn-primary start-lesson" data-lesson-id="${s.id}">\n            ${s.progress>0?"Continue":"Start"} Lesson\n          </button>\n        </div>\n      </div>\n    `,n}(s);e.appendChild(n)}):e.innerHTML='<p class="no-lessons">No lessons found. Try a different filter.</p>')}window.loadLessons=i,window.fetchLessons=l,i()});