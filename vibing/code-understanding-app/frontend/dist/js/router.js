class Router{constructor(){this.routes=new Map,this.currentRoute=null,this.contentContainer=null,this.init()}init(){this.contentContainer=document.querySelector("main")||document.body,this.setupRoutes(),this.setupEventListeners(),this.handleInitialLoad()}setupRoutes(){[{path:"/",file:"index.html"},{path:"/index.html",file:"index.html"},{path:"/lessons.html",file:"lessons.html"},{path:"/editor.html",file:"editor.html"},{path:"/ai.html",file:"ai.html"},{path:"/ask-ai.html",file:"ask-ai.html"},{path:"/code-explainer.html",file:"code-explainer.html"},{path:"/study-guide.html",file:"study-guide.html"},{path:"/lesson-viewer.html",file:"lesson-viewer.html"},{path:"/contact.html",file:"contact.html"}].forEach(t=>{this.routes.set(t.path,t.file)})}handleInitialLoad(){const t=window.location.pathname,e=this.getRouteFromPath(t);e&&(this.currentRoute=e,this.updateNavigationState(e))}setupEventListeners(){document.addEventListener("click",t=>{const e=t.target.closest("a[href]");if(e&&this.shouldInterceptLink(e)){t.preventDefault();const n=e.getAttribute("href");this.navigate(n)}}),window.addEventListener("popstate",t=>{const e=window.location.pathname;this.loadRoute(e,!1)}),document.addEventListener("routeChanged",t=>{this.updateNavigationState(t.detail.route)})}shouldInterceptLink(t){const e=t.getAttribute("href");return!!e&&(!e.startsWith("http")&&!e.startsWith("//")&&(!e.startsWith("#")&&(!e.includes("mailto:")&&!e.includes("tel:")&&(this.routes.has(e)||this.routes.has("/"+e)))))}navigate(t,e=!0){t.startsWith("/")||(t="/"+t),this.loadRoute(t,e)}loadRoute(t,e=!0){const n=this.getRouteFromPath(t);n&&(e&&window.history.pushState({path:t},"",t),this.loadPageContent(n).then(()=>{this.currentRoute=n,this.updateNavigationState(n),this.scrollToTop(),document.dispatchEvent(new CustomEvent("routeChanged",{detail:{route:n,path:t}}))}).catch(e=>{window.location.href=t}))}async loadPageContent(t){try{const e=await fetch(t);if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const n=await e.text(),i=this.extractMainContent(n);this.updatePageContent(i),this.updatePageTitle(n),this.executeScripts(i),this.reinitializeComponents()}catch(t){throw t}}extractMainContent(t){const e=(new DOMParser).parseFromString(t,"text/html");let n=e.querySelector("main");if(!n){const t=e.querySelector("header, .main-header"),i=e.querySelector("footer, .main-footer");if(t&&i){n=document.createElement("div");let e=t.nextElementSibling;for(;e&&e!==i;)n.appendChild(e.cloneNode(!0)),e=e.nextElementSibling}else if(n=e.querySelector("body"),n){const t=n.querySelector("header, .main-header"),e=n.querySelector("footer, .main-footer");t&&t.remove(),e&&e.remove()}}if(!n||!n.innerHTML.trim()){const t=e.querySelector("header, .main-header");if(t){n=document.createElement("div");let e=t.nextElementSibling;for(;e;)e.matches("footer, .main-footer")||n.appendChild(e.cloneNode(!0)),e=e.nextElementSibling}}return n?n.innerHTML:t}updatePageContent(t){let e=document.querySelector("main");if(!e){e=document.createElement("main");const t=document.querySelector("header, .main-header");t?t.insertAdjacentElement("afterend",e):document.body.insertBefore(e,document.body.firstChild)}e.innerHTML="",e.innerHTML=t}updatePageTitle(t){const e=(new DOMParser).parseFromString(t,"text/html").querySelector("title");e&&e.textContent&&(document.title=e.textContent)}executeScripts(t){const e=document.createElement("div");e.innerHTML=t;e.querySelectorAll("script").forEach(t=>{if(t.src){if(!document.querySelector(`script[src="${t.src}"]`)){const e=document.createElement("script");e.src=t.src,e.defer=!0,document.head.appendChild(e)}}else if(t.textContent.trim())try{new Function(t.textContent)()}catch(t){}})}updateNavigationState(t){document.querySelectorAll(".nav-link").forEach(e=>{const n=e.getAttribute("href");n===t||n==="/"+t?(e.classList.add("active"),e.setAttribute("aria-current","page")):(e.classList.remove("active"),e.removeAttribute("aria-current"))}),window.navigationManager&&(window.navigationManager.currentPage=t,window.navigationManager.updateButtonStates()),window.themeManager&&window.themeManager.setupThemeToggle()}scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}getRouteFromPath(t){return"/"===t||""===t?"index.html":(t.startsWith("/")&&(t=t.substring(1)),this.routes.get("/"+t)||this.routes.get(t))}getCurrentRoute(){return this.currentRoute}goTo(t){this.navigate(t)}goBack(){window.history.back()}goForward(){window.history.forward()}reinitializeComponents(){setTimeout(()=>{window.navigationManager&&window.navigationManager.init(),window.themeManager&&window.themeManager.init(),window.kidLearnerApp&&window.kidLearnerApp.initComponents(),document.dispatchEvent(new CustomEvent("pageLoaded",{detail:{route:this.currentRoute}}))},50)}}const router=new Router;window.router=router,"undefined"!=typeof module&&module.exports&&(module.exports=Router);