class ErrorHandler{static handle(e,r="general"){const t=this.categorizeError(e),n=this.getUserMessage(t,e);return this.showErrorToast(n,t),this.logError(e,r,t),t}static categorizeError(e){return"TypeError"===e.name?"type":"ReferenceError"===e.name?"reference":"SyntaxError"===e.name?"syntax":e.message&&e.message.includes("fetch")||e.message&&e.message.includes("Failed to fetch")||e.message&&e.message.includes("NetworkError")?"network":e.message&&e.message.includes("Ollama")||e.message&&e.message.includes("AI")?"ai":e.message&&e.message.includes("localStorage")||e.message&&e.message.includes("QuotaExceededError")?"storage":e.message&&e.message.includes("timeout")?"timeout":e.message&&e.message.includes("403")?"auth":e.message&&e.message.includes("404")?"notfound":e.message&&e.message.includes("500")?"server":"general"}static getUserMessage(e,r){const t={type:"Something went wrong with the data type. Please try again.",reference:"A required component is missing. Please refresh the page.",syntax:"There's a code syntax issue. Please check your code and try again.",network:"Network connection issue. Please check your internet connection and try again.",ai:"AI assistant is temporarily unavailable. Please try again in a few moments.",storage:"Unable to save your progress. Please check your browser storage settings.",timeout:"The request timed out. Please try again.",auth:"Access denied. Please check your permissions.",notfound:"The requested resource was not found. Please try again.",server:"Server error occurred. Please try again later.",general:"An unexpected error occurred. Please try again."};return t[e]||t.general}static showErrorToast(e,r="error",t={}){const n=window.uiManager;if(n){const a="error"===r?"error":"warning"===r?"warning":"info";let s=null;return t.retryCallback&&(s={label:"Try Again",callback:"ErrorHandler.retryLastAction()"}),n.showNotification(e,a,t.duration||5e3,{action:s,persistent:t.persistent||!1}),void(t.retryCallback&&(this.lastRetryCallback=t.retryCallback))}const a=document.createElement("div");a.className=`error-toast error-${r}`,a.setAttribute("role","alert"),a.setAttribute("aria-live","assertive"),a.innerHTML=`\n      <div class="toast-content">\n        <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>\n        <span>${e}</span>\n        <button class="toast-close" onclick="this.parentElement.parentElement.remove()" aria-label="Close error message">\n          <i class="fas fa-times" aria-hidden="true"></i>\n        </button>\n      </div>\n    `,document.body.appendChild(a);const s=t.duration||5e3;if(setTimeout(()=>{a.parentElement&&a.remove()},s),!document.getElementById("error-toast-styles")){const e=document.createElement("style");e.id="error-toast-styles",e.textContent="\n        .error-toast {\n          position: fixed;\n          top: 20px;\n          right: 20px;\n          z-index: 10000;\n          min-width: 300px;\n          max-width: 500px;\n          padding: 0;\n          border-radius: 8px;\n          box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n          animation: slideIn 0.3s ease;\n        }\n\n        .error-error {\n          background: #fee;\n          border-left: 4px solid #e74c3c;\n        }\n\n        .error-warning {\n          background: #fff3cd;\n          border-left: 4px solid #f39c12;\n        }\n\n        .error-info {\n          background: #d1ecf1;\n          border-left: 4px solid #17a2b8;\n        }\n\n        .toast-content {\n          display: flex;\n          align-items: center;\n          gap: 12px;\n          padding: 16px;\n        }\n\n        .toast-content i {\n          font-size: 18px;\n          flex-shrink: 0;\n        }\n\n        .error-error .toast-content i { color: #e74c3c; }\n        .error-warning .toast-content i { color: #f39c12; }\n        .error-info .toast-content i { color: #17a2b8; }\n\n        .toast-content span {\n          flex: 1;\n          font-size: 14px;\n          line-height: 1.4;\n        }\n\n        .toast-close {\n          background: none;\n          border: none;\n          cursor: pointer;\n          padding: 4px;\n          border-radius: 4px;\n          opacity: 0.7;\n          transition: opacity 0.2s;\n        }\n\n        .toast-close:hover,\n        .toast-close:focus {\n          opacity: 1;\n          outline: 2px solid rgba(99, 102, 241, 0.4);\n          outline-offset: 2px;\n        }\n\n        @keyframes slideIn {\n          from {\n            transform: translateX(100%);\n            opacity: 0;\n          }\n          to {\n            transform: translateX(0);\n            opacity: 1;\n          }\n        }\n\n        @media (max-width: 768px) {\n          .error-toast {\n            left: 10px;\n            right: 10px;\n            min-width: auto;\n          }\n        }\n      ",document.head.appendChild(e)}}static retryLastAction(){this.lastRetryCallback&&(this.lastRetryCallback(),this.lastRetryCallback=null)}static logError(e,r,t){const n={timestamp:(new Date).toISOString(),context:r,type:t,message:e.message,stack:e.stack,userAgent:navigator.userAgent,url:window.location.href};try{const e=JSON.parse(localStorage.getItem("error_logs")||"[]");e.push(n),e.length>50&&e.shift(),localStorage.setItem("error_logs",JSON.stringify(e))}catch(e){}}static getErrorLogs(){try{return JSON.parse(localStorage.getItem("error_logs")||"[]")}catch(e){return[]}}static clearErrorLogs(){localStorage.removeItem("error_logs")}static async withErrorHandling(e,r="async",t={}){try{return await e()}catch(n){const a=this.handle(n,r);if(t.retryOnError&&this.shouldRetry(a)&&t.maxRetries>0)return this.retryWithBackoff(e,r,t);throw n}}static withErrorHandlingSync(e,r="sync",t={}){try{return e()}catch(e){throw this.handle(e,r),e}}static shouldRetry(e){return["network","timeout","server"].includes(e)}static async retryWithBackoff(e,r,t,n=1){const a=Math.min(1e3*Math.pow(2,n-1),1e4);await new Promise(e=>setTimeout(e,a));try{return await this.withErrorHandling(e,r,{...t,maxRetries:t.maxRetries-1})}catch(a){if(n<(t.maxRetries||3))return this.retryWithBackoff(e,r,t,n+1);throw a}}static getRecoverySuggestions(e){return{network:["Check your internet connection","Try refreshing the page","Wait a moment and try again"],auth:["Log in again","Check your account permissions","Contact support if the problem persists"],storage:["Clear your browser cache","Try a different browser","Check available storage space"],ai:["AI service is temporarily busy","Try again in a few minutes","Use a simpler query"],timeout:["The request took too long","Try again with a smaller request","Check your connection speed"]}[e]||["Please try again","Refresh the page if the problem continues"]}}window.addEventListener("error",e=>{ErrorHandler.handle(e.error,"global")}),window.addEventListener("unhandledrejection",e=>{ErrorHandler.handle(new Error(e.reason),"promise")});