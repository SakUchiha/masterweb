const CACHE_VERSION="v1.0.4",CACHE_NAME="kidlearner-v1.0.4",STATIC_CACHE="kidlearner-static-v1.0.4",DYNAMIC_CACHE="kidlearner-dynamic-v1.0.4",API_CACHE="kidlearner-api-v1.0.4",STATIC_ASSETS=["/","/index.html","/lessons.html","/editor.html","/ai.html","/ask-ai.html","/study-guide.html","/lesson-viewer.html","/contact.html","/code-explainer.html","/manifest.json","/css/styles.css","/css/ai-styles.css","/js/config.js","/js/api.js","/js/ui.js","/js/app.js","/js/navigation.js","/js/ai.js","/js/ai-chat-only.js","/js/ai-explainer-only.js","/js/syntax-checker.js","/js/error-handler.js","/js/theme.js","/js/error-boundary.js","/js/achievement-system.js","/js/gamification.js","/js/progress-tracker.js","https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css","https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"],API_ENDPOINTS=["/api/lessons","/api/groq/health","/api/groq"];function safeFetch(e){return fetch(e).catch(()=>caches.match(e))}function handleApiRequest(e){return"GET"!==e.method&&"HEAD"!==e.method?Promise.resolve(fetch(e)):caches.open(API_CACHE).then(t=>t.match(e).then(s=>{const a=safeFetch(e).then(s=>(s&&s.ok&&t.put(e,s.clone()),s));return s||a}))}function handleStaticRequest(e){return safeFetch(e).then(t=>{if(t&&t.ok){const s=t.clone();caches.open(STATIC_CACHE).then(t=>{t.put(e,s)})}return t}).catch(()=>caches.match(e))}function handleNavigationRequest(e){return caches.match(e).then(t=>t||safeFetch(e).then(t=>{if(t&&t.ok){const s=t.clone();caches.open(DYNAMIC_CACHE).then(t=>{t.put(e,s)})}return t}).catch(()=>caches.match("/index.html")))}function isStaticAsset(e){const t=new URL(e.url);return[".css",".js",".png",".jpg",".jpeg",".gif",".svg",".woff",".woff2",".ttf",".eot"].some(e=>t.pathname.endsWith(e))||"cdnjs.cloudflare.com"===t.hostname||"fonts.googleapis.com"===t.hostname||"fonts.gstatic.com"===t.hostname}function doBackgroundSync(){}function cleanOldCache(){caches.open(DYNAMIC_CACHE).then(e=>{e.keys().then(e=>{e.forEach(e=>{})})})}self.addEventListener("install",e=>{self.skipWaiting(),e.waitUntil(caches.open(STATIC_CACHE).then(e=>e.addAll(STATIC_ASSETS)))}),self.addEventListener("activate",e=>{e.waitUntil(caches.keys().then(e=>Promise.all(e.map(e=>{if(e!==STATIC_CACHE&&e!==DYNAMIC_CACHE&&e!==API_CACHE)return caches.delete(e)})))),e.waitUntil(clients.claim())}),self.addEventListener("install",e=>{e.waitUntil(caches.open(STATIC_CACHE).then(e=>e.addAll(STATIC_ASSETS)).then(()=>self.skipWaiting()))}),self.addEventListener("activate",e=>{e.waitUntil(caches.keys().then(e=>Promise.all(e.map(e=>{if(!e.includes("v1.0.4"))return caches.delete(e)}))).then(()=>self.clients.claim()))}),self.addEventListener("fetch",e=>{const{request:t}=e;new URL(t.url).pathname.startsWith("/api/")?e.respondWith(handleApiRequest(t)):isStaticAsset(t)?e.respondWith(handleStaticRequest(t)):"navigate"!==t.mode?e.respondWith(caches.match(t).then(e=>e||safeFetch(t).then(e=>{if(e&&e.ok){const s=e.clone();caches.open(DYNAMIC_CACHE).then(e=>{e.put(t,s)})}return e}))):e.respondWith(handleNavigationRequest(t))}),self.addEventListener("sync",e=>{"background-sync"===e.tag&&e.waitUntil(doBackgroundSync())}),self.addEventListener("push",e=>{if(e.data){const t=e.data.json(),s={body:t.body,icon:"/icon-192x192.png",badge:"/icon-192x192.png",vibrate:[100,50,100],data:{dateOfArrival:Date.now(),primaryKey:t.primaryKey}};e.waitUntil(self.registration.showNotification(t.title,s))}}),self.addEventListener("notificationclick",e=>{e.notification.close(),e.waitUntil(clients.openWindow(e.notification.data.url||"/"))}),self.addEventListener("message",e=>{e.data&&("CLEAN_CACHE"===e.data.type?cleanOldCache():"FORCE_UPDATE"===e.data.type?e.waitUntil(caches.keys().then(e=>Promise.all(e.map(e=>caches.delete(e)))).then(()=>self.registration.update())):"SKIP_WAITING"===e.data.type&&self.skipWaiting())}),self.addEventListener("message",e=>{e.data&&e.data.type});